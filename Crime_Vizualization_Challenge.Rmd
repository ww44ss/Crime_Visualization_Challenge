---
title: "SF Crime Visualization"
author: "ww44ss"
date: "Oct  2014"
output: 
html_document:
    keep_md: true
---


```{r "data file information", echo=TRUE}

datadir <-"sfpd"
files <- list.files(datadir)
len<-length(files)

```

There were `r len` files found in the data directory `r getwd()`.  

```{r "get the data"}

datafile = "SFPD_Incidents_-_Previous_Three_Months.csv"
file = paste0(datadir,"/",datafile)    

data <- read.csv(file)

        ##fix day of week order
        data$DayOfWeek <- factor(data$DayOfWeek, levels= c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

        ##for simplicity keep only complete cases
        data<-data[complete.cases(data),]

        data$Date<-as.Date(as.character(data$Date), "%m/%d/%Y")

        #had to be a little clever with the time , basically trick everything to think it is the same day.
        #data$Time<-as.POSIXct(paste("1970-01-01", as.character(data$Time)), format="%Y-%m-%d %H:%M")

        ##while the aboce works. I found the analysis looks easier just hacking out the hour....
        ##Alternate method is just to that the hh and convert to a number
        data$Time <- as.numeric(substring(as.character(data$Time),1,2))

str(data)

        ddata<-dim(data)


```

The above shows the structure of the data. There are statistics on `r ddata[1]` crimes in the file `r "datafile"`. 


###Question 1: Does the number of crimes show obvious variation between weekdays and weekends?

```{r "plot of data", fig.height=3, fig.width=8, fig.align="center"  }

require(ggplot2)
        ##subset data for Monday or Friday to look at weekend versus weekday
        dataXX<-data[data$DayOfWeek=="Monday"|data$DayOfWeek=="Friday"|data$DayOfWeek=="Tuesday"|data$DayOfWeek=="Saturday",]
        ##create plot
        dataXX$DayOfWeek <- factor(dataXX$DayOfWeek, levels= c("Monday", "Tuesday", "Friday", "Saturday"))
        plotA <- ggplot(dataXX, aes(x= factor(PdDistrict)))
        plotA<-plotA+geom_bar(colour="blue", fill="grey")
        plotA<-plotA+facet_grid(.~DayOfWeek)
        plotA<-plotA+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

        print(plotA)

```


Crime rates seem to show correlation to the day of the week, but the correlation appears to depend on the district. For instance the Central and Southern districts are higher on the weekend whereas Taraval and Richmond appear to show little change.  


##Question 2: Digging Deeper: How does crime vary by day on a per district basis?

```{r "plot of data2", fig.height=5, fig.width=10, fig.align="center"  }

require(ggplot2)
require(plyr)

dataX <- ddply(data,.(DayOfWeek, PdDistrict), nrow)

table(dataX$DayOfWeek)

str(dataX)

plotA <- ggplot(dataX, aes(x= factor(DayOfWeek), y = V1))
plotA<- plotA+ geom_point(colour="blue")
plotA<-plotA+facet_wrap(~PdDistrict, ncol=5) 
plotA<-plotA+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#plotA<-plotA+coord_flip()

print(plotA)

```

This is more interesting. Each district has some pretty unique variation.  Some of the more interesting ones are listed below.  
- _Bayview_ is mostly flat, but seems to show a higher rate on Friday nights.   
- _Central_ shows a strong upward trend on the weekends, with Friday and Saturday night showing about 20% increase in crime.   
- _Mission_ while having an overall farily high crime rate, shows little variation.   
- _Tenderloin_ shows an apparent drop in the crime rate.  

##Question 3: Does the type of crime vary by district?  

Observing the variability of crime by district its natural to ask whether the nature of crimes show any district by district distinction. The easiest way to get at this is to just pull the data aprt by district and sort. First let's just look citywide.  

```{r "most prevalent crimes"}

## print an html table of the most prevatlent crimes
        library(xtable)

        ## sort the data
        SF <- sort(table(data$Category), decreasing=TRUE)
        ## turn table into data frame
        SF<-as.data.frame(SF)
        ## just dump the first six lines
        head(SF, n=6)

```


```{r "most prevalent crimes by district", echo=TRUE}

## print an html table of the most prevatlent crimes

        ##subset the data for a few specific districts
        PlotTenderloin <-data[data$PdDistrict=="TENDERLOIN", ]
        PlotMission<-data[data$PdDistrict=="MISSION", ]
        PlotNorthern<-data[data$PdDistrict=="NORTHERN", ]   
        PlotRichmond<-data[data$PdDistrict=="RICHMOND", ]  

        ## sort the data
        ctable <- sort(table(PlotTenderloin$Category), decreasing=TRUE)
        ctable<-as.data.frame(ctable)
        ## keep only top five
        print("TENDERLOIN")
        head(ctable, n=5)

        ## sort the data
        ctable <- sort(table(PlotMission$Category), decreasing=TRUE)
        ctable<-as.data.frame(ctable)
        ## keep only top ten
        print("MISSION")
        head(ctable, n=5)

                ## sort the data
        ctable <- sort(table(PlotNorthern$Category), decreasing=TRUE)
        ctable<-as.data.frame(ctable)
        ## keep only top ten
        print("NORTHERN")
        head(ctable, n=5)

         ## sort the data
        ctable <- sort(table(PlotRichmond$Category), decreasing=TRUE)
        ctable<-as.data.frame(ctable)
        ## keep only top ten
        print("RICHMOND")
        head(ctable, n=5)
        


```


This detail starts to show some of the richness of the data. For instance in the _Mission District_ while Larceny/Theft is the most prevalent item, assualt and drugs/narcotic violations together account for more total crime than the does Larceny/Theft.  
In the _Richmond District_ by contrast, Assault is not among the top six items, while vandalism and vehicle theft together account for less than half of the leading crime, again Larceny/Theft